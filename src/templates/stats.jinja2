{% extends "base_static.jinja2" %}

{% block title %}
    {% trans %}Playback statistics{% endtrans %}
{% endblock title %}

{% block content %}

{{ page_heading(gettext('Playback statistics')) }}

<button id="day">{% trans %}Day{% endtrans %}</button>
<button id="week">{% trans %}Week{% endtrans %}</button>
<button id="month">{% trans %}Month{% endtrans %}</button>
<button id="year">{% trans %}Year{% endtrans %}</button>

<p id="loading">{% trans %}Generating charts...{% endtrans %}</p>

<div id="plots"></div>

<script>

const loading = document.getElementById('loading');
const plots = document.getElementById('plots');
const buttons = ['day', 'week', 'month', 'year'].map(id => document.getElementById(id));

async function loadPlots(button) {
    for (const otherButton of buttons) {
        otherButton.disabled = false;
    }
    button.disabled = true;

    loading.classList.remove('hidden');
    plots.classList.add('hidden');
    plots.replaceChildren();

    const response = await fetch('/stats_data?period=' + encodeURIComponent(button.id));
    const json = await response.json();
    for (const plot of json) {
        const img = document.createElement('img');
        img.src = plot;
        img.classList.add('stats-plot');
        plots.append(img);
    }

    plots.classList.remove('hidden');
    loading.classList.add('hidden');
}

document.addEventListener('DOMContentLoaded', () => {
    for (const button of buttons) {
        button.addEventListener('click', () => loadPlots(button));
    }

    loadPlots(buttons[1]);
});

</script>

{% endblock content %}
